#!/bin/bash

COMMAND=${1:-init}
PROJECT_PATH="."
shift

case $COMMAND in
    init|generate)
        # æ£€æµ‹é¡¹ç›®ç±»åž‹
        if [ -n "$1" ]; then
            PROJECT_PATH="$1"
        fi
        
        cd "$PROJECT_PATH"
        
        echo "ðŸ” æ£€æµ‹é¡¹ç›®ä¿¡æ¯..."
        
        # æ£€æµ‹åŒ…ç®¡ç†å™¨
        if [ -f "package.json" ]; then
            echo "   ðŸ“¦ npm é¡¹ç›®"
            NAME=$(node -p "require('./package.json').name" 2>/dev/null || echo "my-project")
            DESC=$(node -p "require('./package.json').description" 2>/dev/null || echo "A project")
            VERSION=$(node -p "require('./package.json').version" 2>/dev/null || echo "1.0.0")
        elif [ -f "Cargo.toml" ]; then
            echo "   ðŸ“¦ Rust é¡¹ç›®"
            NAME=$(grep -m1 "name" Cargo.toml | cut -d'"' -f2)
            DESC=$(grep -m1 "description" Cargo.toml | cut -d'"' -f2)
            VERSION=$(grep -m1 "version" Cargo.toml | cut -d'"' -f2)
        elif [ -f "setup.py" ]; then
            echo "   ðŸ“¦ Python é¡¹ç›®"
            NAME=$(python3 -c "import re; print(re.search(r'name=[\"']([^\"']+)[\"']', open('setup.py').read()).group(1))" 2>/dev/null || echo "my-project")
        else
            echo "   ðŸ“¦ æœªçŸ¥é¡¹ç›®ç±»åž‹"
            NAME="my-project"
            DESC="A project"
            VERSION="1.0.0"
        fi
        
        # ç”Ÿæˆ README
        cat > README.md << README
# $NAME

$DESC

## ðŸ“¦ å®‰è£…

\`\`\`bash
npm install $NAME
\`\`\`

## ðŸš€ ä½¿ç”¨

\`\`\`javascript
const $NAME = require('$NAME');

TODO: Add usage examples
\`\`\`

## ðŸ“ License

MIT
README
        
        echo "âœ… README.md å·²ç”Ÿæˆ!"
        ;;
    *)
        echo "Usage: readme-gen [init|generate] [path]"
        ;;
esac
